"use strict";var Paperwall=(()=>{var y=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames;var O=Object.prototype.hasOwnProperty;var k=(e,t)=>{for(var a in t)y(e,a,{get:t[a],enumerable:!0})},_=(e,t,a,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of M(t))!O.call(e,r)&&r!==a&&y(e,r,{get:()=>t[r],enumerable:!(n=C(t,r))||n.enumerable});return e};var L=e=>_(y({},"__esModule",{value:!0}),e);var G={};k(G,{Paperwall:()=>f,PaperwallError:()=>i,VERSION:()=>B,parseConfig:()=>c,parseScriptTag:()=>p,sendPing:()=>A});var i=class extends Error{constructor(t){super(t),this.name="PaperwallError"}};function w(e){try{let t=new URL(e);return t.protocol==="http:"||t.protocol==="https:"}catch{return!1}}function P(e){return/^0x[0-9a-fA-F]{40}$/.test(e)}function N(e){return/^[-a-z0-9]{3,8}:[-_a-zA-Z0-9]{1,32}$/.test(e)}function q(e){if(!/^\d+$/.test(e))return!1;try{return BigInt(e)>0n}catch{return!1}}function c(e){if(!e.facilitatorUrl)throw new i("Missing required field: facilitatorUrl");if(!w(e.facilitatorUrl))throw new i("Invalid facilitatorUrl: must be a valid HTTP(S) URL");if(!e.payTo)throw new i("Missing required field: payTo");if(!P(e.payTo))throw new i("Invalid payTo: must be a valid Ethereum address (0x + 40 hex chars)");if(!e.price)throw new i("Missing required field: price");if(!q(e.price))throw new i('Invalid price: must be a positive integer (smallest unit, e.g. "1000000" for $1 USDC)');if(!e.network)throw new i("Missing required field: network");if(!N(e.network))throw new i("Invalid network: must be a valid CAIP-2 identifier (e.g. eip155:1)");if(e.asset&&!P(e.asset))throw new i("Invalid asset: must be a valid Ethereum address (0x + 40 hex chars)");let t=e.mode??"client";if(t==="server"&&!e.paymentUrl)throw new i('Missing paymentUrl: required when mode is "server"');if(e.paymentUrl&&!w(e.paymentUrl))throw new i("Invalid paymentUrl: must be a valid HTTP(S) URL");return{facilitatorUrl:e.facilitatorUrl,payTo:e.payTo,price:e.price,network:e.network,asset:e.asset,mode:t,paymentUrl:e.paymentUrl,siteKey:e.siteKey,onPaymentSuccess:e.onPaymentSuccess,onPaymentError:e.onPaymentError,optimistic:e.optimistic,onOptimisticAccess:e.onOptimisticAccess}}function p(e){let t=e.getAttribute("data-facilitator-url"),a=e.getAttribute("data-pay-to"),n=e.getAttribute("data-price"),r=e.getAttribute("data-network");if(!t||!a||!n||!r)return null;let o=e.getAttribute("data-mode"),d=o==="client"||o==="server"?o:void 0,I=e.getAttribute("data-asset")??void 0,b=e.getAttribute("data-payment-url")??void 0,R=e.getAttribute("data-site-key")??void 0,U=e.getAttribute("data-optimistic")==="false"?!1:void 0;return c({facilitatorUrl:t,payTo:a,price:n,network:r,asset:I,mode:d,paymentUrl:b,siteKey:R,optimistic:U})}var E="x402-payment-required";function D(e){return{x402Version:2,resource:{url:window.location.href,description:"",mimeType:""},accepts:[{scheme:"exact",network:e.network,amount:e.price,asset:e.asset??"0x2e08028E3C4c2356572E096d8EF835cD5C6030bD",payTo:e.payTo}]}}function T(e){u();let t=D(e),a=btoa(JSON.stringify(t)),n=document.createElement("meta");n.name=E,n.content=a,n.setAttribute("data-facilitator-url",e.facilitatorUrl),n.setAttribute("data-mode",e.mode),e.siteKey&&n.setAttribute("data-site-key",e.siteKey);let r=e.optimistic!==!1;n.setAttribute("data-optimistic",String(r)),document.head.appendChild(n)}function u(){let e=document.querySelector(`meta[name="${E}"]`);e&&e.remove()}var m="paperwall-badge",v="paperwall-badge-style",H=`
#${m} {
  position: fixed;
  bottom: 16px;
  right: 16px;
  z-index: 999999;
  padding: 6px 12px;
  background: #1a1a2e;
  color: #e0e0e0;
  font-family: system-ui, -apple-system, sans-serif;
  font-size: 12px;
  font-weight: 600;
  border-radius: 6px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  cursor: default;
  user-select: none;
  opacity: 0.85;
  transition: opacity 0.2s ease;
}
#${m}:hover {
  opacity: 1;
}
`;function x(){if(document.getElementById(m))return;let e=document.createElement("style");e.id=v,e.textContent=H,document.head.appendChild(e);let t=document.createElement("div");t.id=m,t.textContent="Paperwall",t.setAttribute("aria-label","Paperwall micropayment badge"),t.setAttribute("role","status"),document.body.appendChild(t)}function S(){let e=document.getElementById(m);e&&e.remove();let t=document.getElementById(v);t&&t.remove()}var s=null,l=null;function h(e){g();let t=crypto.randomUUID();window.postMessage({type:"PAPERWALL_PAYMENT_REQUIRED",requestId:t,facilitatorUrl:e.facilitatorUrl,payTo:e.payTo,price:e.price,network:e.network,mode:e.mode,siteKey:e.siteKey},window.location.origin);let a=n=>{let r=n.data;if(!(!r||typeof r!="object")){if(r.type==="PAPERWALL_SIGNATURE"&&r.requestId===t){e.mode==="server"&&e.paymentUrl&&K(e,t,r);return}if(r.type==="PAPERWALL_PAYMENT_RESULT"&&r.requestId===t){if(r.optimistic&&r.success){e.onOptimisticAccess&&e.onOptimisticAccess({url:window.location.href,amount:r.receipt?.amount??e.price,requestId:t});return}if(l!==null&&(clearTimeout(l),l=null),s&&(window.removeEventListener("message",s),s=null),r.success&&e.onPaymentSuccess){let o=r.receipt,d={requestId:o.requestId??t,txHash:o.txHash??"",network:o.network??e.network,amount:o.amount??e.price,from:o.from??"",to:o.to??e.payTo,settledAt:o.settledAt??new Date().toISOString(),success:!0,payer:o.from??"",payTo:o.to??e.payTo,resource:window.location.href};e.onPaymentSuccess(d)}else!r.success&&e.onPaymentError&&e.onPaymentError(r.error)}}};s=a,window.addEventListener("message",a),l=setTimeout(()=>{e.onPaymentError&&e.onPaymentError({code:"TIMEOUT",message:"Payment timed out after 120 seconds",requestId:t})},12e4)}function A(){return window.postMessage({type:"PAPERWALL_PING"},window.location.origin),new Promise(e=>{let t=!1,a=r=>{let o=r.data;!o||typeof o!="object"||o.type==="PAPERWALL_PONG"&&(t||(t=!0,window.removeEventListener("message",a),clearTimeout(n),e(!0)))};window.addEventListener("message",a);let n=setTimeout(()=>{t||(t=!0,window.removeEventListener("message",a),e(!1))},2e3)})}async function K(e,t,a){let n=a.payload;if(!(!n||!e.paymentUrl))try{let r=await fetch(e.paymentUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signature:n.signature,authorization:n.authorization})});if(!r.ok){let d=await r.text();e.onPaymentError&&e.onPaymentError({code:"FACILITATOR_ERROR",message:`Server-mode payment failed: ${d}`,requestId:t});return}let o=await r.json();e.onPaymentSuccess&&e.onPaymentSuccess({requestId:t,txHash:o.txHash??"",network:e.network,amount:e.price,from:n.from??"",to:e.payTo,settledAt:o.settledAt??new Date().toISOString(),success:!0,payer:n.from??"",payTo:e.payTo,resource:window.location.href})}catch(r){e.onPaymentError&&e.onPaymentError({code:"NETWORK_ERROR",message:r instanceof Error?r.message:"Server-mode payment failed",requestId:t})}}function g(){s&&(window.removeEventListener("message",s),s=null),l!==null&&(clearTimeout(l),l=null)}var B="0.1.0",f={init(e){let t=c(e);return T(t),h(t),x(),{destroy(){u(),g(),S()}}},autoInit(e){let t=p(e);return t?f.init(t):null}};typeof document<"u"&&document.currentScript&&f.autoInit(document.currentScript);return L(G);})();
